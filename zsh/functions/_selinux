#compdef setsebool getsebool
# thank god i don't have to deal with this often.

_sebooleans() {
  # use local, typeset or etc to scope `selinux_booleans' in the calling function.
  # this prevents the array from staying defined after compsys is done.
  typeset -Ag selinux_booleans
  selinux_booleans=( ${(m)$(getsebool -a)#-->} )
}

_setsebool() {
  local state state_descr context expl line ret
  typeset -A opt_args val_args selinux_booleans

  _arguments : \
    '-P[set permanently]' '-V[verbose]' \
    '*: :->booleans'

  if [[ $state == booleans ]]; then
    local -a args; local bool boolstatus

    _sebooleans
    for bool boolstat in ${(kv)selinux_booleans}; do
      args+=( "$bool:boolean $bool (currently $boolstat):"'(1 0)' )
    done

    _values -w boolean "$args[@]"
  fi
}

_getsebool() {
  local state state_descr context expl line ret
  typeset -A opt_args selinux_booleans

  _sebooleans
  _arguments : \
    '(*)-a[print all booleans]' \
    '(-a)*: :( ${(k)selinux_booleans} )'
}

_selinux() {
  local ret
  _call_function ret _$service
  return ret
}
_selinux "$@"
